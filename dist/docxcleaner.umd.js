(function(s,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(s=typeof globalThis<"u"?globalThis:s||self,S(s.docxcleaner={}))})(this,function(s){"use strict";const S="\r",C=`
`,N=" ",v=" ",V="​";function M(e){return e.nodeType===Node.COMMENT_NODE}function I(e,t){if(!t(e))return;let n=e.firstChild;for(;n;){const i=n,a=n.previousSibling;n=n.nextSibling,I(i,t),!i.previousSibling&&!i.nextSibling&&!i.parentNode&&n&&a!==n.previousSibling&&n.parentNode?a?n=a.nextSibling:n=e.firstChild:!i.previousSibling&&!i.nextSibling&&!i.parentNode&&n&&!n.previousSibling&&!n.nextSibling&&!n.parentNode&&(a?a.nextSibling?n=a.nextSibling.nextSibling:n=null:e.firstChild&&(n=e.firstChild.nextSibling))}}function z(e,t){I(e,r=>M(r)?t(r):!0)}function w(e,t,r){function n(i){return M(i)&&i.data===r}z(e,i=>{if(i.data===t){let a=i.nextSibling;for(i.remove();a&&!n(a);){const{nextSibling:l}=a;a.remove(),a=l}a&&n(a)&&a.remove()}return!0})}function Z(e){return e.nodeType===Node.ELEMENT_NODE}function h(e,t){I(e,r=>Z(r)?t(r):!0)}const qt=["H1","H2","H3","H4","H5","H6"];function K(e){const t=e.cloneNode(!0);if(qt.includes(t.tagName)){const r=document.createElement(t.tagName);r.innerHTML=t.innerHTML,t.innerHTML=r.outerHTML}return w(t,"[if !supportLists]","[endif]"),h(t,r=>(r.getAttribute("style")==="mso-list:Ignore"&&r.remove(),!0)),t.innerHTML}function R(e){const r=(e.getAttribute("style")||"").match(/level(\d+)/im);if(r&&r.length>=1){const[,n]=r;return parseInt(n,10)}return 1}function X(e){return(e.getAttribute("style")||"").startsWith("mso-bookmark")&&!e.textContent}function H(e){const t=e.getAttribute("style");return!t||!/mso-list:\s*l/gim.test(t)?!1:e.querySelector('[style="mso-list:Ignore"]')?!0:e.outerHTML.includes("<!--[if !supportLists]-->")}function Y(e){return e.querySelector('[style="mso-list:Ignore"]')||e.querySelector("span[lang]")}function J(e){return/[0-9a-np-z]\S/g.test(e.toLowerCase())}function tt(e){const t=Y(e);return t?J(t.textContent||""):!1}function et(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function O(e){const t=R(e);let r="",n=e;for(;n;){if(X(n)){n=n.nextElementSibling;continue}if(!H(n))break;const l=R(n);if(l<t)break;if(l>t){const f=O(n);f.list&&(r+=f.list.outerHTML),n=f.nextSibling;continue}r+=`<li>${K(n)}</li>`;const o=n;n=o.nextElementSibling,o.remove()}const i=tt(e)?"ol":"ul";return{list:et(`<${i}>${r}</${i}>`),nextSibling:n}}function F(e,t){const r=document.createElement(t);r.innerHTML=e.innerHTML;for(const{name:n}of e.attributes){const i=e.getAttribute(n);i&&r.setAttribute(n,i)}return e.parentNode&&e.parentNode.replaceChild(r,e),r}function nt(e){h(e,t=>{if(t.tagName!=="BR")return!0;t.nextSibling&&M(t.nextSibling)&&t.nextSibling.data==="[if !supportLineBreakNewLine]"&&w(t.nextSibling,"[if !supportLineBreakNewLine]","[endif]");const r=document.createTextNode(C);return t.parentElement&&t.parentElement.replaceChild(r,t),!1})}function rt(e){return e.replace(/\r\n/gm,`
`).replace(/\r/gm,`
`)}const Bt=["BR","IMG"];function xt(e){return!Bt.includes(e.nodeName)&&!e.innerHTML}function it(e){if(xt(e)){const{parentElement:t}=e;e.remove(),t&&it(t)}}function at(e){h(e,t=>(it(t),!0))}function $t(e){return e.nodeName==="O:P"&&e.textContent===N}function st(e){return e.children.length===1&&e.firstElementChild!==null&&($t(e.firstElementChild)||st(e.firstElementChild))}function ut(e){return h(e,t=>(t.tagName==="P"&&st(t)&&(t.innerHTML=""),!0))}function ot(e){h(e,t=>(t.tagName==="FONT"&&(t.textContent?F(t,"span"):t.remove()),!0))}function lt(e){return e.tagName==="SPAN"&&e.classList.contains("MsoFootnoteReference")}function kt(e){return(e.textContent||"").trim().replace(/[[\]]/g,"")}function ct(e){h(e,t=>{if(lt(t)){const r=document.createElement("sup");return r.textContent=kt(t),t.parentElement&&t.parentElement.replaceChild(r,t),!0}return!0})}function jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var P={exports:{}},D={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function r(i){"@babel/helpers - typeof";return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},r(i)}function n(i){var a=typeof i=="string"||i instanceof String;if(!a){var l=r(i);throw i===null?l="null":l==="object"&&(l=i.constructor.name),new TypeError("Expected a string but received a ".concat(l))}}e.exports=t.default,e.exports.default=t.default})(D,D.exports);var q=D.exports,B={exports:{}},x={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;for(var a in i)typeof n[a]>"u"&&(n[a]=i[a]);return n}e.exports=t.default,e.exports.default=t.default})(x,x.exports);var ft=x.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=i(q),n=i(ft);function i(o){return o&&o.__esModule?o:{default:o}}var a={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function l(o,f){(0,r.default)(o),f=(0,n.default)(f,a),f.allow_trailing_dot&&o[o.length-1]==="."&&(o=o.substring(0,o.length-1)),f.allow_wildcard===!0&&o.indexOf("*.")===0&&(o=o.substring(2));var p=o.split("."),m=p[p.length-1];return f.require_tld&&(p.length<2||!f.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(m)||/\s/.test(m))||!f.allow_numeric_tld&&/^\d+$/.test(m)?!1:p.every(function(b){return!(b.length>63&&!f.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(b)||/[\uff01-\uff5e]/.test(b)||/^-|-$/.test(b)||!f.allow_underscores&&/_/.test(b))})}e.exports=t.default,e.exports.default=t.default})(B,B.exports);var Wt=B.exports,$={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var r=n(q);function n(m){return m&&m.__esModule?m:{default:m}}var i="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",a="(".concat(i,"[.]){3}").concat(i),l=new RegExp("^".concat(a,"$")),o="(?:[0-9a-fA-F]{1,4})",f=new RegExp("^("+"(?:".concat(o,":){7}(?:").concat(o,"|:)|")+"(?:".concat(o,":){6}(?:").concat(a,"|:").concat(o,"|:)|")+"(?:".concat(o,":){5}(?::").concat(a,"|(:").concat(o,"){1,2}|:)|")+"(?:".concat(o,":){4}(?:(:").concat(o,"){0,1}:").concat(a,"|(:").concat(o,"){1,3}|:)|")+"(?:".concat(o,":){3}(?:(:").concat(o,"){0,2}:").concat(a,"|(:").concat(o,"){1,4}|:)|")+"(?:".concat(o,":){2}(?:(:").concat(o,"){0,3}:").concat(a,"|(:").concat(o,"){1,5}|:)|")+"(?:".concat(o,":){1}(?:(:").concat(o,"){0,4}:").concat(a,"|(:").concat(o,"){1,6}|:)|")+"(?::((?::".concat(o,"){0,5}:").concat(a,"|(?::").concat(o,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");function p(m){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(0,r.default)(m),b=String(b),b?b==="4"?l.test(m):b==="6"?f.test(m):!1:p(m,4)||p(m,6)}e.exports=t.default,e.exports.default=t.default})($,$.exports);var Gt=$.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=ae;var r=l(q),n=l(Wt),i=l(Gt),a=l(ft);function l(u){return u&&u.__esModule?u:{default:u}}function o(u,c){return ee(u)||b(u,c)||p(u,c)||f()}function f(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p(u,c){if(u){if(typeof u=="string")return m(u,c);var d=Object.prototype.toString.call(u).slice(8,-1);if(d==="Object"&&u.constructor&&(d=u.constructor.name),d==="Map"||d==="Set")return Array.from(u);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return m(u,c)}}function m(u,c){(c==null||c>u.length)&&(c=u.length);for(var d=0,E=new Array(c);d<c;d++)E[d]=u[d];return E}function b(u,c){var d=u==null?null:typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(d!=null){var E,_,T,L,y=[],g=!0,A=!1;try{if(T=(d=d.call(u)).next,c!==0)for(;!(g=(E=T.call(d)).done)&&(y.push(E.value),y.length!==c);g=!0);}catch(U){A=!0,_=U}finally{try{if(!g&&d.return!=null&&(L=d.return(),Object(L)!==L))return}finally{if(A)throw _}}return y}}function ee(u){if(Array.isArray(u))return u}var ne={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},re=/^\[([^\]]+)\](?::([0-9]+))?$/;function ie(u){return Object.prototype.toString.call(u)==="[object RegExp]"}function Pt(u,c){for(var d=0;d<c.length;d++){var E=c[d];if(u===E||ie(E)&&E.test(u))return!0}return!1}function ae(u,c){if((0,r.default)(u),!u||/[\s<>]/.test(u)||u.indexOf("mailto:")===0||(c=(0,a.default)(c,ne),c.validate_length&&u.length>=2083)||!c.allow_fragments&&u.includes("#")||!c.allow_query_components&&(u.includes("?")||u.includes("&")))return!1;var d,E,_,T,L,y,g,A;if(g=u.split("#"),u=g.shift(),g=u.split("?"),u=g.shift(),g=u.split("://"),g.length>1){if(d=g.shift().toLowerCase(),c.require_valid_protocol&&c.protocols.indexOf(d)===-1)return!1}else{if(c.require_protocol)return!1;if(u.slice(0,2)==="//"){if(!c.allow_protocol_relative_urls)return!1;g[0]=u.slice(2)}}if(u=g.join("://"),u==="")return!1;if(g=u.split("/"),u=g.shift(),u===""&&!c.require_host)return!0;if(g=u.split("@"),g.length>1){if(c.disallow_auth||g[0]===""||(E=g.shift(),E.indexOf(":")>=0&&E.split(":").length>2))return!1;var U=E.split(":"),Dt=o(U,2),se=Dt[0],ue=Dt[1];if(se===""&&ue==="")return!1}T=g.join("@"),y=null,A=null;var Q=T.match(re);if(Q?(_="",A=Q[1],y=Q[2]||null):(g=T.split(":"),_=g.shift(),g.length&&(y=g.join(":"))),y!==null&&y.length>0){if(L=parseInt(y,10),!/^[0-9]+$/.test(y)||L<=0||L>65535)return!1}else if(c.require_port)return!1;return c.host_whitelist?Pt(_,c.host_whitelist):_===""&&!c.require_host?!0:!(!(0,i.default)(_)&&!(0,n.default)(_,c)&&(!A||!(0,i.default)(A,6))||(_=_||A,c.host_blacklist&&Pt(_,c.host_blacklist)))}e.exports=t.default,e.exports.default=t.default})(P,P.exports);var Ut=P.exports;const Qt=jt(Ut);function dt(e){const[,t=""]=e.split("bliptag"),r=t.split("}");if(r.length<2)return null;const[n,i]=r;if(r.length>2&&n.includes("blipuid"))return i.split(v).join("");const a=n.split(v);return a.length<2?null:a.slice(1).join("")}function gt(e){const[t]=e.split("bliptag");return t.includes("pngblip")?"image/png":t.includes("jpegblip")?"image/jpeg":null}const Vt=["\\","{",S,C,v];function pt(e,t){const n=Vt.map(l=>e.indexOf(l)).filter(l=>l!==-1),i=Math.min(e.length,...n),a=e.substring(0,i);return a?`${t}${a}`:null}function k(e,t,r){const[,...n]=e.split(r);return n.reduce((i,a)=>{const[,l=""]=a.split("shplid"),o=pt(l,t),f=gt(l),p=dt(l);return o&&f&&p&&i.push({hex:p,mimeType:f,spid:o}),i},[])}function mt(e){const t={},r=k(e,"i","\\shppict");for(const i of r)t[i.spid]=i;const n=k(e,"s","\\shp");for(const i of n)t[i.spid]=i;return t}function zt(){return NodeFilter.FILTER_ACCEPT}function ht(e){const t=[],r=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT,{acceptNode:zt});let n=r.nextNode();for(;n;)n.nodeValue&&t.push(n.nodeValue),n=r.nextNode();return t}const Zt=new DOMParser;function Et(e){return ht(e).reduce((r,n)=>{try{const i=Zt.parseFromString(n,"text/html");Array.from(i.getElementsByTagName("V:SHAPE")).forEach(l=>{const{id:o}=l,f=l.getAttribute("o:spid");typeof o=="string"&&typeof f=="string"&&(r[o]=f)})}catch{}return r},{})}function j(e){const[,,t]=e.split("_");return t}function bt(e,t){if(t.tagName==="IMG"){const n=t.getAttribute("v:shapes"),i=Et(e);if(!n)return null;const a=i[n];return a?j(a):t.parentElement&&t.parentElement.parentElement&&t.parentElement.parentElement.innerHTML.indexOf("msEquation")>=0?null:j(n)}if(!t.parentElement)return null;const r=t.parentElement.getAttribute("o:spid");return r&&j(r)}function _t(e){const r=(e.match(/\w{2}/g)||[]).map(n=>String.fromCharCode(parseInt(n,16)));return btoa(r.join(""))}function vt(e,t,r){t&&h(r,n=>{if(!["IMG","V:IMAGEDATA"].includes(n.tagName))return!0;if(n.tagName==="IMG"){const f=n.getAttribute("src");if(!f||!f.startsWith("file://"))return!0;const p=n.getAttribute("alt");if(typeof p=="string"&&Qt(p,{require_protocol:!0}))return n.setAttribute("src",p),!0}const i=bt(e,n);if(!i)return!0;const l=mt(t)[i];if(!l)return n.remove(),!0;const o=`data:${l.mimeType};base64,${_t(l.hex)}`;if(n.tagName==="IMG")n.setAttribute("src",o);else if(n.parentNode&&n.parentNode.parentNode){const f=e.createElement("img");f.setAttribute("src",o),n.parentNode.parentNode.replaceChild(f,n.parentNode)}return!0})}function yt(e){return e.startsWith("#")}function W(e){e.outerHTML=e.innerHTML}function St(e){h(e,t=>{if(t.tagName!=="A")return!0;const r=t.getAttribute("href");if((!r||yt(r))&&W(t),r&&t.querySelector("img"))for(const n of t.querySelectorAll("span"))n.innerText||W(n);return!0})}function At(e){h(e,t=>{const r=t.getAttribute("style");return r&&t.setAttribute("style",r.replace(/mso-list:\s*Ignore/gim,"mso-list:Ignore")),!0}),h(e,t=>{if(!H(t))return!0;const{parentElement:r,previousSibling:n}=t;if(!r)return!0;const{list:i}=O(t);if(!i)return!0;const a=n?n.nextSibling:r.firstChild;return a?r.insertBefore(i,a):r.appendChild(i),!1})}function Ct(e){h(e,t=>(t.parentNode&&t.tagName==="P"&&t.classList.contains("MsoQuote")&&F(t,"blockquote"),!0))}function G(e){return Array.from({length:e},()=>v).join("")}function Lt(e){if(e.getAttribute("style")!=="mso-spacerun:yes")return;const r=(e.textContent||"").length,n=document.createTextNode(G(r));e.parentNode&&e.parentNode.replaceChild(n,e)}function Tt(e){const t=e.getAttribute("style")||"";if(!t.startsWith("mso-tab-count:"))return;const[,r]=t.split(":"),n=parseInt(r,10),i=document.createTextNode(G(n));e.parentNode&&e.parentNode.replaceChild(i,e)}function It(e){h(e,t=>(t.nodeName!=="SPAN"||(Lt(t),Tt(t)),!0))}function Nt(e){return e.nodeType===Node.TEXT_NODE}function Mt(e,t){I(e,r=>Nt(r)?t(r):!0)}function wt(e){Mt(e,t=>{if(/^\n\s*$/.test(t.data)&&(t.previousElementSibling||t.nextElementSibling))return t.remove(),!0;if(t.data=t.data.replace(/\n\s*/g,`
`),t.data.includes(S)||t.data.includes(C)||t.data.includes(N)){const r=t.data.includes(v),n=/\S/.test(t.data),i=t.data.includes(C);if(!(r||n)&&!i)return t.data===N?(t.data=v,!0):(t.remove(),!0);if(t.previousSibling&&t.previousSibling.nodeName==="BR"&&t.parentElement){t.parentElement.removeChild(t.previousSibling);const a=t.data.match(/^[\r\n]+/),l=a?a[0].length:0;t.data=t.data.substring(l).replace(new RegExp(C,"g"),v).replace(new RegExp(S,"g"),v),t.data=`
${t.data}`}else t.data=t.data.replace(new RegExp(C,"g"),v).replace(new RegExp(S,"g"),v)}return!0})}function Rt(e){let t=!1;return h(e,r=>{const n=r.getAttribute("style")||"",i=Array.from(r.classList),a=n.includes("mso-")||i.some(l=>l.startsWith("Mso"));return t=t||a,!t}),t}function Ht(e){return`<body>${e.trim().replace(new RegExp(V,"g"),"")}</body>`}function Kt(e){const t=e.indexOf("<html");return t===-1?e:e.substring(t)}function Xt(e){const t=e.lastIndexOf("</html>");return t===-1?e:e.substring(0,t+7)}function Ot(e){return Kt(Xt(e))}const Yt=[Ot,rt];function Ft(e){return Yt.reduce((t,r)=>r(t),e)}const Jt=new DOMParser;function te(e,t){const r=Jt.parseFromString(Ft(e),"text/html"),{body:n}=r;return!t&&!Rt(n)?e:(ct(n),vt(r,t,n),at(n),ut(n),Ct(n),It(n),wt(n),nt(n),St(n),ot(n),At(n),Ht(n.innerHTML))}s.CARRIAGE_RETURN=S,s.LINE_FEED=C,s.NO_BREAK_SPACE=N,s.SPACE=v,s.ZERO_WIDTH_SPACE=V,s.buildList=O,s.changeTagName=F,s.cleanBrElements=nt,s.cleanCrLf=rt,s.cleanDocx=te,s.cleanEmptyElements=at,s.cleanEmptyParagraphs=ut,s.cleanFontElements=ot,s.cleanFootnotes=ct,s.cleanImageElements=vt,s.cleanLinkElements=St,s.cleanListElements=At,s.cleanQuotes=Ct,s.cleanSpacerun=Lt,s.cleanSpans=It,s.cleanTabCount=Tt,s.cleanTextNodes=wt,s.generateSpaces=G,s.getComments=ht,s.getListContentHtml=K,s.getListLevel=R,s.getListTypeNode=Y,s.getRtfImageHex=dt,s.getRtfImageMimeType=gt,s.getRtfImageSpid=pt,s.getRtfImagesByType=k,s.getRtfImagesMap=mt,s.getVShapeSpid=bt,s.getVShapes=Et,s.hexToBase64=_t,s.isBookmark=X,s.isComment=M,s.isDocxContent=Rt,s.isElement=Z,s.isFootnote=lt,s.isFragmentHref=yt,s.isList=H,s.isOrderedList=tt,s.isOrderedListSymbol=J,s.isText=Nt,s.parseHtmlElement=et,s.postCleanHtml=Ht,s.preCleanHtml=Ft,s.removeHtmlSurroundings=Ot,s.removeNodesBetweenComments=w,s.traverse=I,s.traverseComments=z,s.traverseElements=h,s.traverseTexts=Mt,s.unwrapElement=W,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
